
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Menu Restoran - Menuva</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #1e3c72, #2a5298); /* biru elegan */
      margin: 0 0 70px 0; /* kasih space bawah utk fixed bar */
    }
    h1 {
      text-align: center;
      margin-bottom: 5px;
      color: #ddd;
    }
    .logo-resto {
      display: block;
      max-height: 80px;
      margin: 0 auto 10px;
    }
    .nama-resto {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .section-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .warning {
      color: #e74c3c;
      text-align: center;
      margin-bottom: 20px;
    }
    .promo-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 40px;
      justify-content: center;
    }
    .promo-item {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      width: 275px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .promo-item img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .promo-item h3 {
      margin: 0 0 6px 0;
      font-size: 16px;
    }
    .promo-item p {
      font-size: 14px;
      color: #555;
      margin: 0 0 10px 0;
    }
    .promo-item button {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }
    .promo-item button:hover {
      background: #218838;
    }
    .flipbook-section {
      margin-bottom: 40px;
    }
    .flipbook-gallery {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      gap: 10px;
      padding: 10px;
      -webkit-overflow-scrolling: touch;
      scroll-padding: 0 10px;
    }
    .flipbook-gallery img {
      width: 100%;
      max-width: 100vw;
      height: auto;
      object-fit: contain;
      scroll-snap-align: center;
      flex-shrink: 0;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .flipbook-gallery img:active {
      transform: scale(0.97);
    }
    /* fullscreen overlay */
    .fullscreen-overlay {
      display: none;
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .fullscreen-overlay img {
      max-width: 95vw;
      max-height: 90vh;
      border-radius: 10px;
      transition: transform 0.3s ease;
      cursor: zoom-out;
      touch-action: pan-x pan-y;
    }
    .section-title {
      text-align: center;
      font-weight: bold;
      font-size: 20px;
      margin: 30px 0 20px;
      position: relative;
      display: inline-block;
      left: 50%;
      transform: translateX(-50%);
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
    }
    .countdown {
      font-size: 14px;
      margin-bottom: 10px;
      color: #ff5733;
      font-weight: bold;
    }
    .promo-item img {
  width: 100%;
  height: auto;
  object-fit: contain; /* <--- ini penting */
  border-radius: 10px;
  display: block;
  margin: 0 auto;
}
     #infoResto {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 20px auto;
    padding: 10px 20px;
    max-width: 500px;
    text-align: center;
    border: 1px solid #eee;
    border-radius: 8px;
    background-color: #f9f9f9;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    font-size: 15px;
    color: #333;
  }

  #infoResto p {
    margin: 5px 0;
    line-height: 1.5;
  }

    /* Fixed button bar bawah layar */
    .fixed-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(135deg, #1e3c72, #2a5298); /* biru elegan */
      box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 10px 20px;
      z-index: 10000;
    }
    .fixed-bar button {
      flex: 1;
      padding: 14px 0;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      color: white;
    }
    .btn-order {
      background-color: #007bff;
    }
    .btn-order:hover {
      background-color: #0056b3;
    }
    .btn-room {
      background-color: #28a745;
    }
    .btn-room:hover {
      background-color: #1e7e34;
    }

    @media (max-width: 480px) {
      .fixed-bar {
        flex-direction: column;
        padding: 10px;
      }
      .fixed-bar button {
        width: 95%;
        margin-bottom: 8px;
      }
      .fixed-bar button:last-child {
        margin-bottom: 0;
      }
    }
   .flipbook-gallery img {
  border: 2px solid #ccc;        /* Outline abu-abu terang */
  border-radius: 6px;            /* Ujung agak bulat */
  padding: 2px;                  /* Jarak sedikit antara gambar dan border */
  box-sizing: border-box;        /* Biar padding gak ngubah ukuran total */
}
    .flipbook-gallery img:hover {
  border-color: #28a745;
  box-shadow: 0 0 6px rgba(40, 167, 69, 0.5);
}
.btn-book {
  background-color: #ffc107;
}
.btn-book:hover {
  background-color: #e0a800;
}

  </style>
</head>
<body>

<!-- Logo dan Nama Restoran -->
<img id="logoResto" class="logo-resto" src="" alt="Logo Restoran" />
<h1 id="namaRestoDisplay"></h1>
 <div id="infoResto">
  <p id="alamatResto">üìç Adress: </p>
  <p id="teleponResto">üìû Telephone: </p>
</div>
</div>

<!-- Promo Section -->
<section class="flipbook-section" id="promoSection">
  <h1 class="section-title">üéâ Promo Special</h1>
  <div id="promoContainer" class="promo-grid"></div>
  <div id="promoWarning" class="warning"></div>
</section>

<!-- Flipbook Ruangan -->
<section class="flipbook-section" id="flipbookRuanganSection">
  <h1 class="section-title">üì∏ Room Galery</h1>
  <div id="flipbookRuanganGallery" class="flipbook-gallery"></div>
  <div id="ruanganWarning" class="warning"></div>
</section>

<!-- Flipbook Menu -->
<section class="flipbook-section" id="flipbookMenuSection">
  <h1 class="section-title">üìñ Menu Galery</h1>
  <div id="flipbookMenuGallery" class="flipbook-gallery"></div>
  <div id="menuWarning" class="warning"></div>
</section>

<!-- Fullscreen Overlay -->
<div class="fullscreen-overlay" id="fullscreenOverlay" onclick="closeFullscreen()">
  <img id="fullscreenImage" alt="Fullscreen Image" />
</div>

<!-- Fixed Button Bar -->
<div class="fixed-bar">
  <button class="btn-book" onclick="window.location.href='book.html'">üìñ Dine-in Menu Book</button>
  <button class="btn-order" onclick="window.location.href='order.html'">üõí Reserve/Booking</button>
  <button class="btn-room" onclick="window.location.href='room.html'">üè¢ Room/Meeting Room/Package</button>
</div>

<script>
  const DB_NAME = "MenuvaDB";
  const STORE_NAME = "menuvaData";

  function loadDataFromDB() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(DB_NAME, 1);

      request.onerror = () => reject("‚ùå failed open database IndexedDB.");

      request.onsuccess = (event) => {
        const db = event.target.result;
        try {
          const tx = db.transaction(STORE_NAME, "readonly");
          const store = tx.objectStore(STORE_NAME);
          const getReq = store.get(1);
          getReq.onsuccess = () => resolve(getReq.result || {});
          getReq.onerror = () => reject("‚ùå failed read data from object store.");
        } catch (e) {
          reject("‚ùå Error: " + e.message);
        }
      };

      request.onupgradeneeded = (event) => {
        const db = event.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
          db.createObjectStore(STORE_NAME, { keyPath: "id" });
        }
      };
    });
  }

  loadDataFromDB().then(data => {
  document.getElementById("alamatResto").innerText = `üìç Address: ${data.restoAddress || '-'}`;
  document.getElementById("teleponResto").innerText = `üìû Telephone: ${data.restoPhone || '-'}`;
}).catch(err => {
  console.error("Failed load info resto:", err);
});

  function renderFlipbookGallery(containerId, images, warningId) {
    const container = document.getElementById(containerId);
    const warning = document.getElementById(warningId);
    container.innerHTML = "";
    warning.textContent = "";

    if (!images || images.length === 0) {
      warning.textContent = "No pictures.";
      return;
    }

    images.forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      img.alt = "Flipbook Image";
      img.onclick = () => openFullscreen(src);
      container.appendChild(img);
    });
  }

  function openFullscreen(src) {
    const overlay = document.getElementById("fullscreenOverlay");
    const img = document.getElementById("fullscreenImage");
    img.src = src;
    overlay.style.display = "flex";
  }

  function closeFullscreen() {
    document.getElementById("fullscreenOverlay").style.display = "none";
    document.getElementById("fullscreenImage").src = "";
  }

  function renderPromo(promoList) {
  console.log("üî• Data promoList:", promoList);
  const promoContainer = document.getElementById("promoContainer");
  promoContainer.innerHTML = "";

  if (!promoList || promoList.length === 0) {
    document.getElementById("promoWarning").textContent = "‚ùå No promo data available.";
    return;
  }

  promoList.forEach((promo, index) => {
    const promoCard = document.createElement("div");
    promoCard.className = "promo-item"; // pakai class yang sudah ada di CSS kamu

    const img = document.createElement("img");
    console.log("Gambar promo:", promo.image);
    img.src = promo.image;
    img.alt = promo.namaMenu;
    promoCard.appendChild(img);

    const title = document.createElement("h3");
    title.textContent = promo.namaMenu;
    promoCard.appendChild(title);

    const desc = document.createElement("p");
    desc.textContent = promo.deskripsi;
    promoCard.appendChild(desc);

    const price = document.createElement("div");
    price.className = "promo-price";
    price.textContent = ` ${parseInt(promo.harga).toLocaleString("id-ID")}`;
    promoCard.appendChild(price);

    const countdown = document.createElement("div");
    countdown.className = "countdown"; // pakai class countdown dari CSS kamu
    countdown.id = `countdown-${index}`;
    promoCard.appendChild(countdown);

    promoContainer.appendChild(promoCard);

    if (promo.tanggalAkhir) {
      startCountdown(promo.tanggalAkhir, countdown.id);
    } else {
      countdown.textContent = "Tanpa batas waktu";
    }
  });
}

  
function startCountdown(tanggalAkhir, elementId) {
  function updateCountdown() {
    const deadline = new Date(tanggalAkhir).getTime();
    const now = new Date().getTime();
    const distance = deadline - now;

    const el = document.getElementById(elementId);
    if (!el) return;

    if (distance < 0) {
      el.textContent = "Promotion has ended";
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    el.textContent = `Ends in : ${days}.d ${hours}.h ${minutes}.m ${seconds}.s`;
  }

  updateCountdown(); // run immediately
  setInterval(updateCountdown, 1000);
}


  window.onload = async () => {
    try {
      const data = await loadDataFromDB();

      const logoElem = document.getElementById("logoResto");
      if (data.logo) {
        logoElem.src = data.logo;
        logoElem.style.display = "block";
      } else {
        logoElem.style.display = "none";
      }
      document.getElementById("namaRestoDisplay").textContent = data.namaRestoran || "Menu Restoran";

      renderPromo(data.menuPromo);
      renderFlipbookGallery("flipbookRuanganGallery", data.flipbookRuanganImages, "ruanganWarning");
      renderFlipbookGallery("flipbookMenuGallery", data.flipbookMenuImages, "menuWarning");
    } catch (err) {
      console.error(err);
      alert("Gagal load data menu.");
    }
  };
</script>

</body>
</html>
