<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Order Page</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
      margin: 0;
      padding: 0;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background: #121212;
      color: #eee;
    }

    header {
      background: #fff;
      border-bottom: 1px solid #ddd;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
      transition: background 0.3s, color 0.3s;
    }
    body.dark header {
      background: #1f1f1f;
      border-color: #444;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    header p {
      margin: 0;
      font-size: 0.9rem;
    }

    .header-controls {
      margin-top: 0.5rem;
      display: flex;
      gap: 1rem;
    }
    select, button {
      padding: 0.3rem 0.6rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    body.dark select, body.dark button {
      background: #333;
      color: #eee;
      border-color: #555;
    }

    /* Tabs kategori */
    .tabs {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .tab {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
      transition: all 0.3s;
    }
    .tab.active {
      background: #007bff;
      color: #fff;
      border-color: #007bff;
    }
    body.dark .tab {
      background: #222;
      border-color: #444;
    }
    body.dark .tab.active {
      background: #3399ff;
      border-color: #3399ff;
    }

    /* Grid menu */
    .menu-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .menu-item {
      background: #fff;
      border-radius: 12px;
      padding: 0.8rem;
      text-align: center;
      aspect-ratio: 1/1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: background 0.3s, transform 0.2s;
      cursor: pointer;
    }
    .menu-item:hover {
      transform: translateY(-3px);
    }
    body.dark .menu-item {
      background: #1f1f1f;
    }
    .menu-item img {
      max-width: 80%;
      max-height: 70px;
      object-fit: cover;
      border-radius: 8px;
      margin: 0 auto 0.5rem;
    }
    .menu-item h4 {
      margin: 0.2rem 0;
      font-size: 0.95rem;
    }
    .menu-item p {
      margin: 0;
      font-size: 0.85rem;
      color: #666;
    }
    body.dark .menu-item p {
      color: #aaa;
    }

    /* Promo card */
    .promo-container {
      padding: 1rem;
    }
    .promo-card {
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      padding: 1.2rem;
      border-radius: 16px;
      color: #333;
      text-align: center;
    }
    body.dark .promo-card {
      background: linear-gradient(135deg, #333, #555);
      color: #eee;
    }
    .promo-card h3 {
      margin: 0 0 0.5rem;
    }

    /* Order summary */
    .summary {
      padding: 1rem;
      background: #fff;
      border-top: 1px solid #ddd;
      transition: background 0.3s, color 0.3s;
    }
    body.dark .summary {
      background: #1f1f1f;
      border-color: #444;
    }
  </style>
</head>
<body>
  <header>
    <h1>My Resto</h1>
    <p id="resto-address">Address will load here</p>
    <p id="resto-phone">Phone number</p>
    <div class="header-controls">
      <button onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>
      <select id="currency-select" onchange="changeCurrency(this.value)">
        <option value="IDR">Rupiah (IDR)</option>
        <option value="USD">US Dollar (USD)</option>
        <option value="EUR">Euro (EUR)</option>
      </select>
    </div>
  </header>

  <!-- Promo -->
  <section class="promo-container">
    <div class="promo-card" id="promo-card">
      <h3>Promo</h3>
      <p>Promo info will load here</p>
    </div>
  </section>

  <!-- Tabs kategori -->
  <div class="tabs" id="category-tabs"></div>

  <!-- Menu grid -->
  <section class="menu-container" id="menu-container"></section>

  <!-- Summary -->
  <section class="summary">
    <h3>Order Summary</h3>
    <div id="order-summary"></div>
    <button onclick="sendOrder()">Send via WhatsApp</button>
  </section>

  <script>
    // Dark mode
    function toggleDarkMode() {
      document.body.classList.toggle('dark');
      localStorage.setItem('darkMode', document.body.classList.contains('dark'));
    }
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark');
    }

    // Currency handling
    let currentCurrency = detectBrowserCurrency();

    function detectBrowserCurrency() {
      try {
        const locale = navigator.language || 'en-US';
        if (locale.startsWith('id')) return 'IDR';
        if (locale.startsWith('en')) return 'USD';
        if (locale.startsWith('de') || locale.startsWith('fr')) return 'EUR';
        return 'USD';
      } catch {
        return 'USD';
      }
    }
    document.getElementById("currency-select").value = currentCurrency;

    function changeCurrency(currency) {
      currentCurrency = currency;
      renderMenu(currentCategory);
      renderSummary();
    }

    function formatPrice(amount) {
      return new Intl.NumberFormat(undefined, {
        style: 'currency',
        currency: currentCurrency
      }).format(amount);
    }

    // IndexedDB logic (your existing functions, only patched UI binding)
    let db;
    let categories = [];
    let currentCategory = null;
    let cart = [];

    function initDB() {
      const request = indexedDB.open("RestoDB", 1);
      request.onsuccess = e => {
        db = e.target.result;
        loadData();
      };
    }

    function loadData() {
      tampilkanHeader();
      tampilkanPromo();
      tampilkanMenu();
    }

    function tampilkanHeader() {
      document.getElementById("resto-address").textContent = "Jl. Example No.123, Jakarta";
      document.getElementById("resto-phone").textContent = "+62 812 3456 7890";
    }

    function tampilkanPromo() {
      document.getElementById("promo-card").innerHTML = `
        <h3>Special Discount</h3>
        <p>Get 20% off for all menu today!</p>
      `;
    }

    function tampilkanMenu() {
      // Example menu
      const menu = [
        {name: "Nasi Goreng", price: 20000, category: "Food", img:"https://via.placeholder.com/100"},
        {name: "Mie Ayam", price: 15000, category: "Food", img:"https://via.placeholder.com/100"},
        {name: "Es Teh", price: 5000, category: "Drink", img:"https://via.placeholder.com/100"},
        {name: "Puding", price: 10000, category: "Dessert", img:"https://via.placeholder.com/100"}
      ];
      categories = [...new Set(menu.map(m => m.category))];
      if (!currentCategory) currentCategory = categories[0];
      renderTabs();
      renderMenu(currentCategory, menu);
    }

    function renderTabs() {
      const tabsContainer = document.getElementById("category-tabs");
      tabsContainer.innerHTML = "";
      categories.forEach(cat => {
        const tab = document.createElement("div");
        tab.className = "tab" + (cat === currentCategory ? " active" : "");
        tab.textContent = cat;
        tab.onclick = () => {
          currentCategory = cat;
          renderMenu(currentCategory);
        };
        tabsContainer.appendChild(tab);
      });
    }

    function renderMenu(category, menuList) {
      const menu = menuList || [
        {name: "Nasi Goreng", price: 20000, category: "Food", img:"https://via.placeholder.com/100"},
        {name: "Mie Ayam", price: 15000, category: "Food", img:"https://via.placeholder.com/100"},
        {name: "Es Teh", price: 5000, category: "Drink", img:"https://via.placeholder.com/100"},
        {name: "Puding", price: 10000, category: "Dessert", img:"https://via.placeholder.com/100"}
      ];
      const container = document.getElementById("menu-container");
      container.innerHTML = "";
      menu.filter(m => m.category === category).forEach(item => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}">
          <h4>${item.name}</h4>
          <p>${formatPrice(item.price)}</p>
          <button onclick="addToCart('${item.name}', ${item.price})">Add</button>
        `;
        container.appendChild(div);
      });
      renderTabs();
    }

    function addToCart(name, price) {
      cart.push({name, price});
      renderSummary();
    }

    function renderSummary() {
      const summary = document.getElementById("order-summary");
      summary.innerHTML = "";
      let total = 0;
      cart.forEach(c => {
        total += c.price;
        summary.innerHTML += `<p>${c.name} - ${formatPrice(c.price)}</p>`;
      });
      summary.innerHTML += `<hr><strong>Total: ${formatPrice(total)}</strong>`;
    }

    function sendOrder() {
      let text = "Order:\n";
      cart.forEach(c => text += `${c.name} - ${formatPrice(c.price)}\n`);
      alert("Sending to WhatsApp:\n" + text);
    }

    initDB();
  </script>
</body>
</html>
